type: charm

parts:
  charm:
    build-packages:
      - tox
      - git
      - python3-dev
    override-build: |
      apt-get install ca-certificates -y
      tox -e build-reactive
    override-stage: |
      STAGE_DIR=${CRAFT_STAGE:-$CHARMCRAFT_STAGE}
      BUILD_DIR=${CRAFT_PART_BUILD:-$CHARMCRAFT_PART_BUILD}

      echo "Copying charm to staging area: $STAGE_DIR"
      NAME=$(ls $BUILD_DIR/build/builds)
      cp -r $BUILD_DIR/build/builds/$NAME/* $STAGE_DIR/
    override-prime: |
      # For some reason, the normal priming chokes on the fact that there's a
      # hooks directory.
      STAGE_DIR=${CRAFT_STAGE:-$CHARMCRAFT_STAGE}
      cp -r $STAGE_DIR/* .

bases:
  - name: ubuntu
    channel: "20.04"
    architectures: [amd64]
  - name: ubuntu
    channel: "20.04"
    architectures: [arm64]
  - name: ubuntu
    channel: "20.04"
    architectures: [ppc64el]
  - name: ubuntu
    channel: "20.04"
    architectures: [s390x]
  - name: ubuntu
    channel: "22.04"
    architectures: [amd64]
  - name: ubuntu
    channel: "22.04"
    architectures: [arm64]
  - name: ubuntu
    channel: "22.04"
    architectures: [ppc64el]
  - name: ubuntu
    channel: "22.04"
    architectures: [s390x]
